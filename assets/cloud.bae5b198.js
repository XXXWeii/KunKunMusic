import{d as e,M as a,N as l,O as s,_ as o,P as t,ag as r,r as u,p as n,z as c,j as i,af as p,U as m,W as d,Q as v,a9 as g,S as f,at as h,cp as y,bD as b,cq as w,aw as S,bo as C,ay as x,$ as _,R as k,cr as j,aE as $,ax as D}from"./index.2d658157.js";import{D as N}from"./DataLists.3ba2b8b8.js";import{P as q}from"./index.fe593983.js";import"./SmallSongData.9d069edf.js";import"./InputNumber.6e3256f5.js";import"./Add.4fe37192.js";import"./FormItem.8e86c8fa.js";import"./PlayOne.a9053696.js";import"./Select.bcceca04.js";const z={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},R=[s("path",{d:"M19 11c0-3.87-3.13-7-7-7a6.99 6.99 0 0 0-6.74 5.15A5.49 5.49 0 0 0 1 14.5C1 17.54 3.46 20 6.5 20h12c2.49-.01 4.5-2.03 4.5-4.52c0-2.33-1.75-4.22-4-4.48zm-6 2v2c0 .55-.45 1-1 1s-1-.45-1-1v-2H9.21c-.45 0-.67-.54-.35-.85l2.79-2.79c.2-.2.51-.2.71 0l2.79 2.79a.5.5 0 0 1-.35.85H13z",fill:"currentColor"},null,-1)],I=e({name:"BackupRound",render:function(e,s){return a(),l("svg",z,R)}}),M={class:"cloud"},P={class:"data"},F={key:0,class:"space"},G=o({__name:"cloud",setup(e){const o=t(),z=r(),R=u([]),G=u([]),A=u(30),B=u(o.currentRoute.value.query.page?Number(o.currentRoute.value.query.page):1),E=u(0),H=u(null),L=u("success"),O=u(!1),U=u(0),Q=(e=30,a=0,l=!0)=>{y(e,a).then((e=>{E.value=e.count,G.value=[],R.value=[(e.size/Math.pow(1024,3)).toFixed(2),(e.maxSize/Math.pow(1024,3)).toFixed(0)],e.data?e.data.forEach(((e,a)=>{G.value.push({id:e.songId,num:a+1+(B.value-1)*A.value,name:e.simpleSong.name,artist:e.simpleSong.ar,album:e.simpleSong.al,alia:e.simpleSong.alia,mv:e.simpleSong.mv,time:b(e.simpleSong.dt)})})):$message.error("搜索内容为空"),$mainContent&&l&&$mainContent.scrollIntoView({behavior:"smooth"})}))},T=e=>{const{loaded:a,total:l}=e,s=Math.round(100*a/l);U.value=Number(s)},V=e=>{const a=e.target.files;if(!a[0])return!1;L.value="success",O.value=!0,w(a[0],T).then((e=>{var a,l;200===e.code?(W(),(null==(a=e.privateCloud.simpleSong.al)?void 0:a.name)||$message.warning("上传歌曲详细信息获取失败，可尝试歌曲纠正"),$message.success((null==(l=e.privateCloud.simpleSong)?void 0:l.name)+" 上传成功"),Q(A.value,(B.value-1)*A.value)):(L.value="error",$message.error("歌曲上传出错，请重试"),console.error("歌曲上传出错，请重试"))})).catch((e=>{L.value="error",W(),$message.error("歌曲上传出现错误"),console.error("歌曲上传出现错误："+e)}))},W=()=>{O.value=!1,U.value=0,H.value.value=null},J=()=>{W(),H.value.click()},K=e=>{A.value=e,Q(e,(B.value-1)*A.value)},X=e=>{o.push({path:"/user/cloud",query:{page:e}})};return n("cloudDataLoad",((e=!1)=>{Q(A.value,(B.value-1)*A.value,e)})),c((()=>o.currentRoute.value),(e=>{B.value=Number(e.query.page?e.query.page:1),"user-cloud"==e.name&&Q(A.value,(B.value-1)*A.value)})),i((()=>{$setSiteTitle("音乐库 - 音乐云盘"),Q(A.value,(B.value-1)*A.value)})),(e,o)=>{const t=p,r=S,u=j,n=$,c=C,i=D,y=x;return a(),l("div",M,[s("div",P,[m(r,{class:"up",type:"primary",strong:"",secondary:"",round:"",onClick:o[0]||(o[0]=e=>v(H).click())},{icon:d((()=>[m(t,{component:v(I)},null,8,["component"])])),default:d((()=>[_(" 上传歌曲 ")])),_:1}),s("input",{ref_key:"upSongRef",ref:H,type:"file",style:{display:"none"},accept:"audio/*",onChange:V},null,544),v(R)[0]?(a(),l("div",F,[s("span",null,g(v(R)[0])+" G",1),m(c,{trigger:"hover"},{trigger:d((()=>[m(u,{type:"line",color:v(z).themeData.primaryColor,class:"progress","show-indicator":!1,percentage:100/(v(R)[1]/v(R)[0])},null,8,["color","percentage"])])),default:d((()=>[m(n,null,{default:d((()=>[_(" 已用 "+g((100/(v(R)[1]/v(R)[0])).toFixed())+"%，剩余 "+g(v(R)[1]-v(R)[0])+" G ",1)])),_:1})])),_:1}),s("span",null,g(v(R)[1])+" G",1)])):f("",!0)]),m(N,{listData:v(G)},null,8,["listData"]),m(q,{totalCount:v(E),pageNumber:v(B),onPageSizeChange:K,onPageNumberChange:X},null,8,["totalCount","pageNumber"]),m(y,{class:"s-modal close",show:v(O),"onUpdate:show":o[1]||(o[1]=e=>h(O)?O.value=e:null),preset:"card",title:"云盘上传","auto-focus":!1,bordered:!1,"close-on-esc":!1,esc:!1,"mask-closable":!1},{footer:d((()=>["error"===v(L)?(a(),k(i,{key:0,justify:"end"},{default:d((()=>[m(r,{onClick:W},{default:d((()=>[_(" 取消 ")])),_:1}),m(r,{type:"primary",onClick:J},{default:d((()=>[_(" 重新上传 ")])),_:1})])),_:1})):f("",!0)])),default:d((()=>[m(u,{type:"line",status:v(L),percentage:v(U),"indicator-placement":"inside",processing:""},null,8,["status","percentage"])])),_:1},8,["show"])])}}},[["__scopeId","data-v-b7ff3426"]]);export{G as default};
