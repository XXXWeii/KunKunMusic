import{as as e,U as s,a4 as l,a5 as a,r as t,M as i,R as o,W as r,$ as n,Q as u,at as p,au as d,av as c,aw as m,ax as y,ay as v,_ as g,P as f,j as h,N as k,X as b,Y as C,O as L,a9 as _,S as w,aa as U,T as $,A as x,az as T,aA as j,af as P,aB as R,aC as A}from"./index.2d658157.js";import{l as V}from"./album.095eb62c.js";import{f as H}from"./formRules.1ad773f3.js";import{_ as M,a as z}from"./FormItem.8e86c8fa.js";import{_ as D}from"./Select.bcceca04.js";import{P as S}from"./PlayOne.a9053696.js";import{a as B,_ as N}from"./Grid.cc39c44f.js";import{_ as W}from"./Skeleton.2e7bf840.js";const Z=e("headset",!1,(function(e){return s("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[s("path",{d:"M42 30V24.4615C42 14.2655 33.9411 6 24 6C14.0589 6 6 14.2655 6 24.4615V30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),s("path",{d:"M34 32C34 29.7909 35.7909 28 38 28H42V42H38C35.7909 42 34 40.2091 34 38V32Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),s("path",{d:"M42 32H44C45.1046 32 46 32.8954 46 34V36C46 37.1046 45.1046 38 44 38H42V32Z",fill:e.colors[0]},null),s("path",{d:"M6 32H4C2.89543 32 2 32.8954 2 34V36C2 37.1046 2.89543 38 4 38H6V32Z",fill:e.colors[0]},null),s("path",{d:"M6 28H10C12.2091 28 14 29.7909 14 32V38C14 40.2091 12.2091 42 10 42H6V28Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null)])})),I={__name:"PlaylistUpdate",setup(e,{expose:g}){const{textRule:f}=H(),h=l(),k=a(),b=t(null),C=t(null),L=t(!1),_={name:f},w=t({name:null,desc:null,tags:null}),U=e=>{var s;e.preventDefault(),null==(s=C.value)||s.validate((e=>{e?($loadingBar.error(),$message.error("请检查您的输入")):d(b.value,w._value.name,w._value.desc,w._value.tags.join(";")).then((e=>{200===e.code?($message.success("编辑成功"),T(),k.setUserPlayLists()):$message.error("编辑失败，请重试")}))}))},$=t([]),x=()=>{h.catList.sub?$.value=h.catList.sub.map((e=>({label:e.name,value:e.name}))):h.setCatList()},T=()=>{L.value=!1,b.value=null};return g({openUpdateModel:e=>{w.value={name:e.name,desc:e.desc,tags:e.tags},b.value=e.id,L.value=!0}}),(e,l)=>{const a=c,t=M,d=D,g=z,f=m,h=y,k=v;return i(),o(k,{class:"s-modal",show:u(L),"onUpdate:show":l[3]||(l[3]=e=>p(L)?L.value=e:null),preset:"card",title:"歌单编辑",bordered:!1,"on-after-leave":T},{footer:r((()=>[s(h,{justify:"end"},{default:r((()=>[s(f,{onClick:T},{default:r((()=>[n(" 取消 ")])),_:1}),s(f,{type:"primary",onClick:U},{default:r((()=>[n(" 编辑 ")])),_:1})])),_:1})])),default:r((()=>[s(g,{ref_key:"playlistUpdateRef",ref:C,rules:_,"label-width":80,model:u(w)},{default:r((()=>[s(t,{label:"歌单名称",path:"name"},{default:r((()=>[s(a,{value:u(w).name,"onUpdate:value":l[0]||(l[0]=e=>u(w).name=e),placeholder:"请输入歌单名称"},null,8,["value"])])),_:1}),s(t,{label:"歌单描述",path:"desc"},{default:r((()=>[s(a,{value:u(w).desc,"onUpdate:value":l[1]||(l[1]=e=>u(w).desc=e),placeholder:"请输入歌单描述",type:"textarea",autosize:{minRows:3,maxRows:5}},null,8,["value"])])),_:1}),s(t,{label:"歌单标签",path:"tags"},{default:r((()=>[s(d,{multiple:"",value:u(w).tags,"onUpdate:value":l[2]||(l[2]=e=>u(w).tags=e),placeholder:"请输入歌单标签",options:u($),onClick:x},null,8,["value","options"])])),_:1})])),_:1},8,["model"])])),_:1},8,["show"])}}},q={class:"coverlists"},O={class:"cover"},X={key:0,class:"description"},Y={key:0,class:"num"},F={class:"des"},G={key:1,class:"num"},Q={class:"des"},E={class:"title"},J={class:"name text-hidden"},K={key:0,class:"by"},ee={key:1,class:"by"},se=g({__name:"CoverLists",props:{listData:{type:Array,default:[]},listType:{type:String,default:"playlist"},columns:{type:String,default:"3 s:4 m:5 l:6"},gridCollapsed:{type:Boolean,default:!1},gridCollapsedRows:{type:Number,default:2},loadingNum:{type:Number,default:30}},setup(e){const n=e,p=f(),d=l(),c=a(),m=t(null),y=t(0),v=t(0),g=t(!1),H=t(null),M=()=>{g.value=!1},z=e=>{$dialog.warning({class:"s-dialog",title:"删除歌单",content:"确认删除歌单 "+e.name+"？删除后将不可恢复！",positiveText:"删除",negativeText:"取消",onPositiveClick:()=>{T(e.id).then((e=>{200===e.code&&($message.success("删除成功"),c.setUserPlayLists())}))}})},D=e=>{const s=n.listType,l=c.getUserPlayLists.like,a=c.getUserAlbumLists.list;return"playlist"===s&&l.length?!l.some((s=>s.id===e)):"album"!==s||!a.length||!a.some((s=>s.id===e))},se=async e=>{const s=n.listType,l=D(e)?1:2,a="playlist"===s?A:V,t="playlist"===s?"歌单":"专辑";try{200===(await a(l,e)).code?($message.success(`${t}${1==l?"收藏成功":"取消收藏成功"}`),"playlist"===s?c.setUserPlayLists():c.setUserAlbumLists()):$message.error(`${t}${1==l?"收藏失败":"取消收藏失败"}`)}catch(i){$message.error(`${t}${1==l?"收藏失败":"取消收藏失败"}`),console.error(`${t}${1==l?"收藏失败：":"取消收藏失败："}`+i)}};return h((()=>{"user-playlists"!==p.currentRoute.value.name||d.catList.sub||d.setCatList(),!c.userLogin||c.getUserPlayLists.has||c.getUserPlayLists.isLoading||"playlist"!==n.listType||c.setUserPlayLists(),!c.userLogin||c.getUserAlbumLists.has||c.getUserAlbumLists.isLoading||"album"!==n.listType||c.setUserAlbumLists()})),(l,a)=>{const t=j,d=P,f=B,h=N,T=W,A=R;return i(),k("div",q,[s($,{mode:"out-in"},{default:r((()=>[e.listData[0]?(i(),o(h,{key:0,"x-gap":"20","y-gap":"26",responsive:"screen",cols:e.columns,collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:r((()=>[(i(!0),k(b,null,C(e.listData,(l=>(i(),o(f,{class:"item",key:l,onClick:e=>{return s=l.id,void("playlist"===n.listType||"topList"===n.listType?p.push({path:"/playlist",query:{id:s,page:1}}):"album"===n.listType&&p.push({path:"/album",query:{id:s}}));var s},onContextmenu:e=>{return a=l,(s=e).preventDefault(),g.value=!1,void x().then((()=>{H.value=[{key:"update",label:"编辑歌单",show:"user-playlists"===p.currentRoute.value.name,props:{onClick:()=>{m.value.openUpdateModel(a)}}},{key:"del",label:"删除歌单",show:"user-playlists"===p.currentRoute.value.name,props:{onClick:()=>{z(a)}}},{key:"likePlaylist",label:D(a.id)?"收藏歌单":"取消收藏歌单",show:!(!c.userLogin||!c.getUserPlayLists.has||"playlist"!==n.listType||"user-playlists"===p.currentRoute.value.name),props:{onClick:()=>{se(a.id)}}},{key:"likeAlbum",label:D(a.id)?"收藏专辑":"取消收藏专辑",show:!(!c.userLogin||!c.getUserAlbumLists.has||"album"!==n.listType),props:{onClick:()=>{se(a.id)}}},{key:"copy",label:`复制${"playlist"===n.listType?"歌单":"专辑"}链接`,props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/${"playlist"===n.listType?"playlist":"album"}?id=${a.id}`),$message.success(("playlist"===n.listType?"歌单":"专辑")+"链接复制成功")}catch(e){$message.error("复制失败：",e)}else $message.error("您的浏览器暂不支持该操作")}}}],g.value=!0,y.value=s.clientX,v.value=s.clientY}));var s,a}},{default:r((()=>[L("div",O,[s(t,{class:"coverImg",src:l.cover.replace(/^http:/,"https:")+"?param=300y300","fallback-src":"/images/pic/default.png"},null,8,["src"]),s(d,{class:"play",size:"40"},{default:r((()=>[s(u(S),{theme:"filled"})])),_:1}),"topList"!=e.listType?(i(),k("div",X,["playlist"==e.listType?(i(),k("div",Y,[s(d,null,{default:r((()=>[s(u(Z),{theme:"filled"})])),_:1}),L("span",F,_(l.playCount),1)])):(i(),k("div",G,[L("span",Q,_(l.time),1)]))])):w("",!0)]),L("div",E,[L("span",J,_(l.name),1),"playlist"==e.listType&&l.artist?(i(),k("span",K," By "+_(l.artist.nickname),1)):"topList"==e.listType&&l.update?(i(),k("span",ee,_(l.update),1)):(i(),o(U,{key:2,class:"text-hidden",artistsData:l.artist},null,8,["artistsData"]))])])),_:2},1032,["onClick","onContextmenu"])))),128))])),_:1},8,["cols","collapsed","collapsed-rows"])):(i(),o(h,{key:1,class:"loading","x-gap":"20","y-gap":"26",cols:e.columns,responsive:"screen",collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:r((()=>[(i(!0),k(b,null,C(e.loadingNum,(e=>(i(),o(f,{class:"item",key:e},{default:r((()=>[s(T,{class:"pic",sharp:!1}),s(T,{text:"",repeat:1}),s(T,{text:"",style:{width:"60%"}})])),_:2},1024)))),128))])),_:1},8,["cols","collapsed","collapsed-rows"]))])),_:1}),s(A,{style:{"--n-font-size":"14px","--n-border-radius":"6px"},placement:"bottom-start",trigger:"manual",size:"large",x:u(y),y:u(v),options:u(H),show:u(g),"on-clickoutside":M,onSelect:a[0]||(a[0]=e=>g.value=!1)},null,8,["x","y","options","show"]),s(I,{ref_key:"playlistUpdateRef",ref:m},null,512)])}}},[["__scopeId","data-v-2b96907b"]]);export{se as C};
